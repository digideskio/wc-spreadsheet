<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<script src="../mock-http-request/lib/mock.js"></script>
<script src="../js-xlsx/dist/xlsx.js"></script>

<!--
An element providing a solution to no problem in particular.

Example:

    <wc-spreadsheet></wc-spreadsheet>

@demo
-->
<dom-module id="wc-spreadsheet">

    <style>

        .hover {
            opacity: .7;
            border: 1px dashed #111;
        }
    </style>

    <template>
        <div id="DropZone" style="height: 100px; width: 100%; border: 1px solid #111;">
            DROP HERE
        </div>
        <div id="DataZone"></div>
    </template>

</dom-module>

<script>

    Polymer({

        is: 'wc-spreadsheet',

        properties: {},

        // Element Lifecycle

        ready: function () {
            this.setupDrop();

        },

        attached: function () {

        },

        detached: function () {
        },

        setupDrop: function () {
            var dropZone = this.$.DropZone;

            dropZone.ondragover = function (e) {
                e.stopPropagation();
                this.toggleClass("hover", true, dropZone);
                return false;
            }.bind(this);
            dropZone.ondragleave = function () {
                this.toggleClass("hover", false, dropZone);
                return false;
            }.bind(this);
            dropZone.ondrop = function (e) {
                console.log('ondrop');
                this.toggleClass("hover", false, dropZone);
                e.stopPropagation();
                e.preventDefault();
                var files = e.dataTransfer.files;
                var i, f;
                for (i = 0, f = files[i]; i != files.length; ++i) {
                    var reader = new FileReader();
                    var name = f.name;
                    reader.onload = function (e) {

                        if (name.indexOf(".xls") != -1) {
                            var data = e.target.result;
                            this.loadBinaryData(data);
                        }
                    }.bind(this);
                    reader.readAsBinaryString(f);
                }
            }.bind(this);
        },

        loadBinaryData: function (data) {
            /* if binary string, read with type 'binary' */
            var workbook = XLSX.read(data, {type: 'binary'});
            console.log(workbook);
            console.log(workbook.SheetNames);
        }

    });

</script>
